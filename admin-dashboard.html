<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin Dashboard - Masthan Brailour Poultry Traders</title>
    <link rel="stylesheet" href="styles.css">
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600;700&display=swap" rel="stylesheet">
    <link rel="icon" type="image/jpeg" href="images/MBPT LOGO.jpeg">

    <!-- Add Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script>
    <style>
        .navbar {
            background-color: rgba(255, 255, 255, 0.95);
            padding: 1rem 2rem;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
            position: relative;
            z-index: 1000;
        }

        .nav-brand a {
            color: var(--primary-color);
            font-weight: 600;
            font-size: 1.5rem;
            text-decoration: none;
        }

        .nav-links {
            display: flex;
            gap: 2rem;
            list-style: none;
            margin: 0;
            padding: 0;
        }

        .nav-links a {
            color: var(--text-color);
            text-decoration: none;
            font-weight: 500;
            transition: color 0.3s ease;
        }

        .nav-links a:hover {
            color: var(--primary-color);
        }

        .admin-dashboard {
            padding-top: 1rem;
        }

        .dashboard-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 2rem;
            padding: 1rem;
        }

        .summary-cards {
            display: grid;
            grid-template-columns: 1fr;
            gap: 1rem;
        }

        .summary-card {
            background: white;
            padding: 1.5rem;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        }

        .price-management {
            background: white;
            padding: 1.5rem;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        }

        .price-inputs-grid {
            display: grid;
            grid-template-columns: 1fr;
            gap: 1rem;
        }

        @media (max-width: 768px) {
            .navbar {
                padding: 1rem;
            }

            .nav-links {
                gap: 1rem;
            }

            .dashboard-grid {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div class="admin-dashboard">
        <header class="admin-header">
            <h1>Admin Dashboard</h1>
            <div class="header-actions">
                <button type="button" id="logoutBtn" class="logout-btn" aria-label="Logout">Logout</button>
            </div>
        </header>

        <main class="admin-main">
            <div class="dashboard-grid">
                <section class="price-summary">
                    <h2>Live Prices</h2>
                    <div class="summary-cards">
                        <div class="summary-card">
                            <h3>With Skin Chicken</h3>
                            <div class="price-change">
                                <span class="current-price" id="withSkinCurrent"></span>
                                <span class="change-indicator" id="withSkinChange"></span>
                            </div>
                        </div>
                        <div class="summary-card">
                            <h3>Skinless Chicken</h3>
                            <div class="price-change">
                                <span class="current-price" id="skinlessCurrent"></span>
                                <span class="change-indicator" id="skinlessChange"></span>
                            </div>
                        </div>
                        <div class="summary-card">
                            <h3>100 Eggs</h3>
                            <div class="price-change">
                                <span class="current-price" id="eggsCurrent"></span>
                                <span class="change-indicator" id="eggsChange"></span>
                            </div>
                        </div>
                        <div class="summary-card">
                            <h3>Live Rate</h3>
                            <div class="price-change">
                                <span class="current-price" id="liveRateCurrent"></span>
                                <span class="change-indicator" id="liveRateChange"></span>
                            </div>
                        </div>
                    </div>
                </section>

                <section class="price-management">
                    <h2>Manage Prices</h2>
                    <form id="priceUpdateForm" class="admin-form">
                        <div class="price-inputs-grid">
                            <div class="form-group">
                                <label for="withSkinPrice">With Skin Chicken (₹/kg)</label>
                                <input type="number" id="withSkinPrice" name="withSkinPrice" required>
                            </div>
                            <div class="form-group">
                                <label for="skinlessPrice">Skinless Chicken (₹/kg)</label>
                                <input type="number" id="skinlessPrice" name="skinlessPrice" required>
                            </div>
                            <div class="form-group">
                                <label for="eggsPrice">100 Eggs Price (₹)</label>
                                <input type="number" id="eggsPrice" name="eggsPrice" required>
                            </div>
                            <div class="form-group">
                                <label for="liveRate">Live Rate (₹/kg)</label>
                                <input type="number" id="liveRate" name="liveRate" required>
                            </div>
                        </div>
                        <button type="submit" class="submit-btn">Update Prices</button>
                    </form>
                </section>
            </div>
        </main>
    </div>

    <script type="module">
        // Import the functions you need from the SDKs you need
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.9.1/firebase-app.js";
        import { getAnalytics } from "https://www.gstatic.com/firebasejs/11.9.1/firebase-analytics.js";
        import { getDatabase, ref, set, onValue } from "https://www.gstatic.com/firebasejs/11.9.1/firebase-database.js";
        import { getAuth, signInWithEmailAndPassword, onAuthStateChanged, signOut } from "https://www.gstatic.com/firebasejs/11.9.1/firebase-auth.js";

        // Your web app's Firebase configuration
        const firebaseConfig = {
            apiKey: "AIzaSyAefiwRw1-CGmKPpBzhs1kveUPdc82UWAU",
            authDomain: "masthan-prices.firebaseapp.com",
            databaseURL: "https://masthan-prices-default-rtdb.firebaseio.com",
            projectId: "masthan-prices",
            storageBucket: "masthan-prices.firebasestorage.app",
            messagingSenderId: "879026480403",
            appId: "1:879026480403:web:1abbf69da8ef379ccd26e6",
            measurementId: "G-LCCQZS6Q1V"
        };

        // Initialize Firebase
        const app = initializeApp(firebaseConfig);
        const analytics = getAnalytics(app);
        const database = getDatabase(app);
        const auth = getAuth(app);

        console.log("Firebase initialized in admin dashboard");

        // Check authentication state
        onAuthStateChanged(auth, (user) => {
            if (!user) {
                // Not logged in, redirect to login page
                window.location.href = 'admin-login.html';
            }
        });

        // Price variables
        let currentPrices = {
            withSkinPrice: 180,
            skinlessPrice: 220,
            eggsPrice: 579,
            liveRate: 100
        };

        // Function to format price with currency symbol
        function formatPrice(price, unit = '') {
            return `₹${price}${unit}`;
        }

        // Load current prices from Firebase
        function loadCurrentPrices() {
            console.log("Loading current prices from Firebase...");
            const pricesRef = ref(database, 'prices');
            onValue(pricesRef, (snapshot) => {
                const prices = snapshot.val() || currentPrices;
                console.log("Received prices from Firebase:", prices);
                currentPrices = prices;

                document.getElementById('withSkinPrice').value = currentPrices.withSkinPrice;
                document.getElementById('skinlessPrice').value = currentPrices.skinlessPrice;
                document.getElementById('eggsPrice').value = currentPrices.eggsPrice;
                document.getElementById('liveRate').value = currentPrices.liveRate;

                // Update summary display
                updatePriceSummary(currentPrices, currentPrices);
            });
        }

        // Update prices in Firebase
        async function updatePrices(event) {
            event.preventDefault();
            
            try {
                const oldPrices = { ...currentPrices };
                
                const newPrices = {
                    withSkinPrice: parseFloat(document.getElementById('withSkinPrice').value),
                    skinlessPrice: parseFloat(document.getElementById('skinlessPrice').value),
                    eggsPrice: parseFloat(document.getElementById('eggsPrice').value),
                    liveRate: parseFloat(document.getElementById('liveRate').value),
                    lastUpdated: new Date().toISOString()
                };

                console.log('Attempting to update prices:', newPrices);

                // Update Firebase
                const pricesRef = ref(database, 'prices');
                await set(pricesRef, newPrices);
                
                // Update local state
                currentPrices = newPrices;
                
                // Show success message
                alert('Prices updated successfully!');
                
                // Update summary display
                updatePriceSummary(oldPrices, newPrices);
            } catch (error) {
                console.error('Error updating prices:', error);
                alert('Error updating prices. Please try again.');
            }
        }

        // Function to update price summary display
        function updatePriceSummary(oldPrices, newPrices) {
            const priceElements = {
                'withSkinCurrent': 'withSkinPrice',
                'skinlessCurrent': 'skinlessPrice',
                'eggsCurrent': 'eggsPrice',
                'liveRateCurrent': 'liveRate'
            };

            for (const [elementId, priceKey] of Object.entries(priceElements)) {
                const element = document.getElementById(elementId);
                if (element) {
                    const price = newPrices[priceKey];
                    const unit = priceKey === 'eggsPrice' ? '' : '/kg';
                    element.textContent = formatPrice(price, unit);
                }
            }
        }

        // Initialize
        document.addEventListener('DOMContentLoaded', function() {
            console.log("Page loaded, initializing...");
            loadCurrentPrices();

            // Add form submit handler
            const priceUpdateForm = document.getElementById('priceUpdateForm');
            if (priceUpdateForm) {
                priceUpdateForm.addEventListener('submit', updatePrices);
            }

            // Add logout handler
            const logoutBtn = document.getElementById('logoutBtn');
            if (logoutBtn) {
                logoutBtn.addEventListener('click', async function() {
                    try {
                        await signOut(auth);
                        window.location.href = 'admin-login.html';
                    } catch (error) {
                        console.error('Error signing out:', error);
                        alert('Error signing out. Please try again.');
                    }
                });
            }
        });
    </script>
</body>
</html> 